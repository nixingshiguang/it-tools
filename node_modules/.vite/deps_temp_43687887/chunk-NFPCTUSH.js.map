{
  "version": 3,
  "sources": ["../../.pnpm/@unhead+dom@0.5.1/node_modules/@unhead/dom/dist/index.mjs"],
  "sourcesContent": ["const TagsWithInnerContent = [\"script\", \"style\", \"noscript\"];\n\nconst UniqueTags = [\"base\", \"title\", \"titleTemplate\", \"bodyAttrs\", \"htmlAttrs\"];\nconst ArrayMetaProperties = [\n  \"og:image\",\n  \"og:video\",\n  \"og:audio\",\n  \"og:locale:alternate\",\n  \"video:actor\",\n  \"video:director\",\n  \"video:writer\",\n  \"video:tag\",\n  \"article:author\",\n  \"article:tag\",\n  \"book:tag\",\n  \"book:author\",\n  \"music:album\",\n  \"music:musician\"\n];\nfunction tagDedupeKey(tag) {\n  const { props, tag: tagName } = tag;\n  if (UniqueTags.includes(tagName))\n    return tagName;\n  if (tagName === \"link\" && props.rel === \"canonical\")\n    return \"canonical\";\n  if (props.charset)\n    return \"charset\";\n  const name = [\"id\"];\n  if (tagName === \"meta\")\n    name.push(...[\"name\", \"property\", \"http-equiv\"]);\n  for (const n of name) {\n    if (typeof props[n] !== \"undefined\") {\n      const val = String(props[n]);\n      if (ArrayMetaProperties.findIndex((p) => val.startsWith(p)) !== -1)\n        return false;\n      return `${tagName}:${n}:${val}`;\n    }\n  }\n  return false;\n}\n\nasync function renderDOMHead(head, options = {}) {\n  const ctx = { shouldRender: true };\n  await head.hooks.callHook(\"dom:beforeRender\", ctx);\n  if (!ctx.shouldRender)\n    return;\n  const dom = options.document || window.document;\n  const staleSideEffects = head._popSideEffectQueue();\n  head.headEntries().map((entry) => entry._sde).forEach((sde) => {\n    Object.entries(sde).forEach(([key, fn]) => {\n      staleSideEffects[key] = fn;\n    });\n  });\n  const renderTag = (tag, entry) => {\n    if (tag.tag === \"title\" && tag.children) {\n      dom.title = tag.children;\n      return dom.head.querySelector(\"title\");\n    }\n    const markSideEffect = (key, fn) => {\n      key = `${tag._d || tag._p}:${key}`;\n      entry._sde[key] = fn;\n      delete staleSideEffects[key];\n    };\n    const setAttrs = ($el, sideEffects = true) => {\n      Object.entries(tag.props).forEach(([k, value]) => {\n        value = String(value);\n        const attrSdeKey = `attr:${k}`;\n        if (k === \"class\") {\n          for (const c of value.split(\" \")) {\n            const classSdeKey = `${attrSdeKey}:${c}`;\n            sideEffects && markSideEffect(classSdeKey, () => $el.classList.remove(c));\n            if (!$el.classList.contains(c))\n              $el.classList.add(c);\n          }\n          return;\n        }\n        if (sideEffects && !k.startsWith(\"data-h-\"))\n          markSideEffect(attrSdeKey, () => $el.removeAttribute(k));\n        if ($el.getAttribute(k) !== value)\n          $el.setAttribute(k, value);\n      });\n      if (TagsWithInnerContent.includes(tag.tag))\n        $el.innerHTML = tag.children || \"\";\n    };\n    if (tag.tag === \"htmlAttrs\" || tag.tag === \"bodyAttrs\") {\n      const $el = dom[tag.tag === \"htmlAttrs\" ? \"documentElement\" : \"body\"];\n      setAttrs($el);\n      return $el;\n    }\n    let $newEl = dom.createElement(tag.tag);\n    setAttrs($newEl, false);\n    let $previousEl;\n    for (const $el of dom[tag.tagPosition?.startsWith(\"body\") ? \"body\" : \"head\"].children) {\n      const key = $el.getAttribute(\"data-h-key\") || tagDedupeKey({\n        tag: $el.tagName.toLowerCase(),\n        props: Array.from($el.attributes).map((attr) => [attr.name, attr.value]).reduce((acc, [k, v]) => ({ ...acc, [k]: v }), {})\n      });\n      if (key === tag._d || $el.isEqualNode($newEl)) {\n        $previousEl = $el;\n        break;\n      }\n    }\n    if ($previousEl) {\n      markSideEffect(\"el\", () => {\n        $previousEl?.remove();\n      });\n      setAttrs($previousEl, false);\n      return $previousEl;\n    }\n    switch (tag.tagPosition) {\n      case \"bodyClose\":\n        $newEl = dom.body.appendChild($newEl);\n        break;\n      case \"bodyOpen\":\n        $newEl = dom.body.insertBefore($newEl, dom.body.firstChild);\n        break;\n      case \"head\":\n      default:\n        $newEl = dom.head.appendChild($newEl);\n        break;\n    }\n    markSideEffect(\"el\", () => $newEl?.remove());\n    return $newEl;\n  };\n  for (const tag of await head.resolveTags()) {\n    const entry = head.headEntries().find((e) => e._i === Number(tag._e));\n    const renderCtx = { $el: null, shouldRender: true, tag, entry, queuedSideEffects: staleSideEffects };\n    await head.hooks.callHook(\"dom:beforeRenderTag\", renderCtx);\n    if (!renderCtx.shouldRender)\n      continue;\n    renderCtx.$el = renderTag(renderCtx.tag, renderCtx.entry);\n    await head.hooks.callHook(\"dom:renderTag\", renderCtx);\n  }\n  Object.values(staleSideEffects).forEach((fn) => fn());\n}\nlet domUpdatePromise = null;\nasync function debouncedRenderDOMHead(head, options = {}) {\n  function doDomUpdate() {\n    domUpdatePromise = null;\n    return renderDOMHead(head, options);\n  }\n  const delayFn = options.delayFn || ((fn) => setTimeout(fn, 10));\n  return domUpdatePromise = domUpdatePromise || new Promise((resolve) => delayFn(() => resolve(doDomUpdate())));\n}\n\nexport { debouncedRenderDOMHead, domUpdatePromise, renderDOMHead };\n"],
  "mappings": "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",
  "names": []
}
